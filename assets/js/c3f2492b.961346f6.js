"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[7284],{3349:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>r,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module2-simulation/project","title":"Project: Autonomous Navigation in Simulation","description":"Project Objectives","source":"@site/docs/module2-simulation/06-project.md","sourceDirName":"module2-simulation","slug":"/module2-simulation/project","permalink":"/physical-ai-book/docs/module2-simulation/project","draft":false,"unlisted":false,"editUrl":"https://github.com/syedaareebashah/physical-ai-book/edit/main/docs/module2-simulation/06-project.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Building Test Environments","permalink":"/physical-ai-book/docs/module2-simulation/building-environments"},"next":{"title":"Module 2 Assessment","permalink":"/physical-ai-book/docs/module2-simulation/assessment"}}');var o=a(4848),t=a(8453);const l={sidebar_position:6},s="Project: Autonomous Navigation in Simulation",r={},c=[{value:"Project Objectives",id:"project-objectives",level:2},{value:"Project Overview",id:"project-overview",level:2},{value:"System Architecture",id:"system-architecture",level:2},{value:"Implementation Steps",id:"implementation-steps",level:2},{value:"Step 1: Create the Project Package",id:"step-1-create-the-project-package",level:3},{value:"Step 2: Install Dependencies",id:"step-2-install-dependencies",level:3},{value:"Step 3: Robot URDF Model",id:"step-3-robot-urdf-model",level:3},{value:"Step 4: Controller Configuration",id:"step-4-controller-configuration",level:3},{value:"Step 5: Navigation Configuration",id:"step-5-navigation-configuration",level:3},{value:"Step 6: Simulation Launch File",id:"step-6-simulation-launch-file",level:3},{value:"Step 7: Custom World File",id:"step-7-custom-world-file",level:3},{value:"Step 8: Performance Evaluation Node",id:"step-8-performance-evaluation-node",level:3},{value:"Step 9: Package Configuration",id:"step-9-package-configuration",level:3},{value:"Step 10: Running the System",id:"step-10-running-the-system",level:3},{value:"Physical AI Concepts Demonstrated",id:"physical-ai-concepts-demonstrated",level:2},{value:"Multi-Sensor Integration",id:"multi-sensor-integration",level:3},{value:"Navigation Stack Integration",id:"navigation-stack-integration",level:3},{value:"Performance Evaluation",id:"performance-evaluation",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues and Solutions",id:"common-issues-and-solutions",level:3},{value:"Chapter Summary",id:"chapter-summary",level:2},{value:"Exercises",id:"exercises",level:2},{value:"Next Steps",id:"next-steps",level:2}];function _(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"project-autonomous-navigation-in-simulation",children:"Project: Autonomous Navigation in Simulation"})}),"\n",(0,o.jsx)(e.h2,{id:"project-objectives",children:"Project Objectives"}),"\n",(0,o.jsx)(e.p,{children:"By completing this project, you will:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Integrate Gazebo simulation with ROS 2 navigation stack"}),"\n",(0,o.jsx)(e.li,{children:"Implement perception and planning systems for autonomous navigation"}),"\n",(0,o.jsx)(e.li,{children:"Create a complete simulation environment for navigation testing"}),"\n",(0,o.jsx)(e.li,{children:"Validate navigation performance using evaluation metrics"}),"\n",(0,o.jsx)(e.li,{children:"Deploy the system from simulation to potential real hardware"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"project-overview",children:"Project Overview"}),"\n",(0,o.jsx)(e.p,{children:"In this project, we'll build an autonomous navigation system that operates in Gazebo simulation. The system will:"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:"Localize itself in the simulated environment"}),"\n",(0,o.jsx)(e.li,{children:"Plan paths to specified goals"}),"\n",(0,o.jsx)(e.li,{children:"Navigate while avoiding obstacles"}),"\n",(0,o.jsx)(e.li,{children:"Evaluate its performance using metrics"}),"\n",(0,o.jsx)(e.li,{children:"Provide a framework for testing different navigation algorithms"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"system-architecture",children:"System Architecture"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:"Goal Input \u2192 Path Planner \u2192 Local Planner \u2192 Robot Controller \u2192 Sensor Feedback\n     \u2191                                                              \u2193\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Map & Localization \u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(e.h2,{id:"implementation-steps",children:"Implementation Steps"}),"\n",(0,o.jsx)(e.h3,{id:"step-1-create-the-project-package",children:"Step 1: Create the Project Package"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# Create project workspace\nmkdir -p ~/nav_simulation_ws/src\ncd ~/nav_simulation_ws/src\n\n# Create navigation package\nros2 pkg create --build-type ament_python nav_simulation\ncd nav_simulation\n"})}),"\n",(0,o.jsx)(e.h3,{id:"step-2-install-dependencies",children:"Step 2: Install Dependencies"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# Install navigation stack\nsudo apt install ros-humble-navigation2 ros-humble-nav2-bringup\n\n# Install simulation packages\nsudo apt install ros-humble-gazebo-ros-pkgs ros-humble-gazebo-ros2-control\n"})}),"\n",(0,o.jsx)(e.h3,{id:"step-3-robot-urdf-model",children:"Step 3: Robot URDF Model"}),"\n",(0,o.jsx)(e.p,{children:"First, let's create a simple differential drive robot model:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-xml",children:'\x3c!-- File: nav_simulation/urdf/diff_robot.urdf --\x3e\n<?xml version="1.0"?>\n<robot name="diff_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">\n\n  \x3c!-- Base link --\x3e\n  <link name="base_link">\n    <visual>\n      <geometry>\n        <cylinder length="0.2" radius="0.3"/>\n      </geometry>\n      <material name="blue">\n        <color rgba="0 0 0.8 1"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <cylinder length="0.2" radius="0.3"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="10"/>\n      <inertia ixx="1.0" ixy="0.0" ixz="0.0" iyy="1.0" iyz="0.0" izz="1.0"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Left wheel --\x3e\n  <joint name="left_wheel_joint" type="continuous">\n    <parent link="base_link"/>\n    <child link="left_wheel"/>\n    <origin xyz="0 0.3 -0.1" rpy="1.57 0 0"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  <link name="left_wheel">\n    <visual>\n      <geometry>\n        <cylinder length="0.05" radius="0.1"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0 0 0 1"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <cylinder length="0.05" radius="0.1"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="1"/>\n      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Right wheel --\x3e\n  <joint name="right_wheel_joint" type="continuous">\n    <parent link="base_link"/>\n    <child link="right_wheel"/>\n    <origin xyz="0 -0.3 -0.1" rpy="1.57 0 0"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  <link name="right_wheel">\n    <visual>\n      <geometry>\n        <cylinder length="0.05" radius="0.1"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0 0 0 1"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <cylinder length="0.05" radius="0.1"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="1"/>\n      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Camera --\x3e\n  <joint name="camera_joint" type="fixed">\n    <parent link="base_link"/>\n    <child link="camera_link"/>\n    <origin xyz="0.2 0 0.1" rpy="0 0 0"/>\n  </joint>\n\n  <link name="camera_link">\n    <visual>\n      <geometry>\n        <box size="0.05 0.05 0.05"/>\n      </geometry>\n      <material name="red">\n        <color rgba="0.8 0 0 1"/>\n      </material>\n    </visual>\n  </link>\n\n  \x3c!-- LiDAR --\x3e\n  <joint name="lidar_joint" type="fixed">\n    <parent link="base_link"/>\n    <child link="lidar_link"/>\n    <origin xyz="0 0 0.2" rpy="0 0 0"/>\n  </joint>\n\n  <link name="lidar_link">\n    <visual>\n      <geometry>\n        <cylinder radius="0.05" length="0.05"/>\n      </geometry>\n      <material name="green">\n        <color rgba="0 0.8 0 1"/>\n      </material>\n    </visual>\n  </link>\n\n  \x3c!-- Gazebo plugins --\x3e\n  <gazebo>\n    <plugin filename="libgazebo_ros2_control.so" name="gazebo_ros2_control">\n      <parameters>$(find nav_simulation)/config/diff_robot_controllers.yaml</parameters>\n    </plugin>\n  </gazebo>\n\n  \x3c!-- Camera sensor --\x3e\n  <gazebo reference="camera_link">\n    <sensor name="camera" type="camera">\n      <always_on>true</always_on>\n      <update_rate>30</update_rate>\n      <camera name="head_camera">\n        <horizontal_fov>1.047</horizontal_fov>\n        <image>\n          <width>640</width>\n          <height>480</height>\n        </image>\n        <clip>\n          <near>0.1</near>\n          <far>10.0</far>\n        </clip>\n      </camera>\n      <plugin filename="libgazebo_ros_camera.so" name="camera_controller">\n        <frame_name>camera_link</frame_name>\n        <topic_name>/camera/image_raw</topic_name>\n      </plugin>\n    </sensor>\n  </gazebo>\n\n  \x3c!-- LiDAR sensor --\x3e\n  <gazebo reference="lidar_link">\n    <sensor name="lidar" type="ray">\n      <always_on>true</always_on>\n      <update_rate>10</update_rate>\n      <ray>\n        <scan>\n          <horizontal>\n            <samples>360</samples>\n            <resolution>1</resolution>\n            <min_angle>-3.14159</min_angle>\n            <max_angle>3.14159</max_angle>\n          </horizontal>\n        </scan>\n        <range>\n          <min>0.1</min>\n          <max>10.0</max>\n          <resolution>0.01</resolution>\n        </range>\n      </ray>\n      <plugin filename="libgazebo_ros_ray_sensor.so" name="lidar_controller">\n        <ros_topic>/scan</ros_topic>\n        <frame_name>lidar_link</frame_name>\n      </plugin>\n    </sensor>\n  </gazebo>\n\n</robot>\n'})}),"\n",(0,o.jsx)(e.h3,{id:"step-4-controller-configuration",children:"Step 4: Controller Configuration"}),"\n",(0,o.jsx)(e.p,{children:"Create the controller configuration file:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'# File: nav_simulation/config/diff_robot_controllers.yaml\ncontroller_manager:\n  ros__parameters:\n    update_rate: 100  # Hz\n\n    joint_state_broadcaster:\n      type: joint_state_broadcaster/JointStateBroadcaster\n\n    diff_drive_controller:\n      type: diff_drive_controller/DiffDriveController\n\ndiff_drive_controller:\n  ros__parameters:\n    left_wheel_names: ["left_wheel_joint"]\n    right_wheel_names: ["right_wheel_joint"]\n\n    wheel_separation: 0.6\n    wheel_radius: 0.1\n\n    use_stamped_vel: false\n\n    # Publish rate\n    publish_rate: 50.0\n    odom_frame_id: odom\n    base_frame_id: base_link\n    pose_covariance_diagonal: [0.001, 0.001, 0.001, 0.001, 0.001, 0.01]\n    twist_covariance_diagonal: [0.001, 0.001, 0.001, 0.001, 0.001, 0.01]\n'})}),"\n",(0,o.jsx)(e.h3,{id:"step-5-navigation-configuration",children:"Step 5: Navigation Configuration"}),"\n",(0,o.jsx)(e.p,{children:"Create the navigation configuration:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'# File: nav_simulation/config/nav2_params.yaml\namcl:\n  ros__parameters:\n    use_sim_time: True\n    alpha1: 0.2\n    alpha2: 0.2\n    alpha3: 0.2\n    alpha4: 0.2\n    alpha5: 0.2\n    base_frame_id: "base_link"\n    beam_skip_distance: 0.5\n    beam_skip_error_threshold: 0.9\n    beam_skip_threshold: 0.3\n    do_beamskip: false\n    global_frame_id: "map"\n    lambda_short: 0.1\n    laser_likelihood_max_dist: 2.0\n    laser_max_range: 100.0\n    laser_min_range: -1.0\n    laser_model_type: "likelihood_field"\n    max_beams: 60\n    max_particles: 2000\n    min_particles: 500\n    odom_frame_id: "odom"\n    pf_err: 0.05\n    pf_z: 0.99\n    recovery_alpha_fast: 0.0\n    recovery_alpha_slow: 0.0\n    resample_interval: 1\n    robot_model_type: "nav2_amcl::DifferentialMotionModel"\n    save_pose_rate: 0.5\n    sigma_hit: 0.2\n    tf_broadcast: true\n    transform_tolerance: 1.0\n    update_min_a: 0.2\n    update_min_d: 0.25\n    z_hit: 0.5\n    z_max: 0.05\n    z_rand: 0.5\n    z_short: 0.05\n    scan_topic: scan\n\namcl_map_client:\n  ros__parameters:\n    use_sim_time: True\n\namcl_rclcpp_node:\n  ros__parameters:\n    use_sim_time: True\n\nbt_navigator:\n  ros__parameters:\n    use_sim_time: True\n    global_frame: map\n    robot_base_frame: base_link\n    odom_topic: /odom\n    bt_loop_duration: 10\n    default_server_timeout: 20\n    enable_groot_monitoring: True\n    groot_zmq_publisher_port: 1666\n    groot_zmq_server_port: 1667\n    # Specify the path where the BT XML files are located\n    plugin_lib_names:\n    - nav2_compute_path_to_pose_action_bt_node\n    - nav2_follow_path_action_bt_node\n    - nav2_back_up_action_bt_node\n    - nav2_spin_action_bt_node\n    - nav2_wait_action_bt_node\n    - nav2_clear_costmap_service_bt_node\n    - nav2_is_stuck_condition_bt_node\n    - nav2_goal_reached_condition_bt_node\n    - nav2_goal_updated_condition_bt_node\n    - nav2_initial_pose_received_condition_bt_node\n    - nav2_reinitialize_global_localization_service_bt_node\n    - nav2_rate_controller_bt_node\n    - nav2_distance_controller_bt_node\n    - nav2_speed_controller_bt_node\n    - nav2_truncate_path_action_bt_node\n    - nav2_goal_updater_node_bt_node\n    - nav2_recovery_node_bt_node\n    - nav2_pipeline_sequence_bt_node\n    - nav2_round_robin_node_bt_node\n    - nav2_transform_available_condition_bt_node\n    - nav2_time_expired_condition_bt_node\n    - nav2_path_expiring_timer_condition\n    - nav2_distance_traveled_condition_bt_node\n    - nav2_single_trigger_bt_node\n    - nav2_is_battery_low_condition_bt_node\n    - nav2_navigate_through_poses_action_bt_node\n    - nav2_navigate_to_pose_action_bt_node\n    - nav2_remove_passed_goals_action_bt_node\n    - nav2_planner_selector_bt_node\n    - nav2_controller_selector_bt_node\n    - nav2_goal_checker_selector_bt_node\n\nbt_navigator_rclcpp_node:\n  ros__parameters:\n    use_sim_time: True\n\ncontroller_server:\n  ros__parameters:\n    use_sim_time: True\n    controller_frequency: 20.0\n    min_x_velocity_threshold: 0.001\n    min_y_velocity_threshold: 0.5\n    min_theta_velocity_threshold: 0.001\n    progress_checker_plugin: "progress_checker"\n    goal_checker_plugin: "goal_checker"\n    controller_plugins: ["FollowPath"]\n\n    # Progress checker parameters\n    progress_checker:\n      plugin: "nav2_controller::SimpleProgressChecker"\n      required_movement_radius: 0.5\n      movement_time_allowance: 10.0\n\n    # Goal checker parameters\n    goal_checker:\n      plugin: "nav2_controller::SimpleGoalChecker"\n      xy_goal_tolerance: 0.25\n      yaw_goal_tolerance: 0.25\n      stateful: True\n\n    # Controller parameters\n    FollowPath:\n      plugin: "nav2_rotation_shim_controller::RotationShimController"\n      progress_checker_plugin: "progress_checker"\n      goal_checker_plugin: "goal_checker"\n      required_movement_radius: 0.5\n      movement_time_allowance: 10.0\n      velocity_deadband: 0.05\n      simulate_ahead_time: 1.0\n      max_rotational_vel: 1.0\n      min_rotational_vel: 0.4\n      rotational_acc_lim: 3.2\n\nlocal_costmap:\n  local_costmap:\n    ros__parameters:\n      update_frequency: 5.0\n      publish_frequency: 2.0\n      global_frame: odom\n      robot_base_frame: base_link\n      use_sim_time: True\n      rolling_window: true\n      width: 3\n      height: 3\n      resolution: 0.05\n      robot_radius: 0.3\n      plugins: ["voxel_layer", "inflation_layer"]\n      inflation_layer:\n        plugin: "nav2_costmap_2d::InflationLayer"\n        cost_scaling_factor: 3.0\n        inflation_radius: 0.55\n      voxel_layer:\n        plugin: "nav2_costmap_2d::VoxelLayer"\n        enabled: True\n        publish_voxel_map: True\n        origin_z: 0.0\n        z_resolution: 0.05\n        z_voxels: 16\n        max_obstacle_height: 2.0\n        mark_threshold: 0\n        observation_sources: scan\n        scan:\n          topic: /scan\n          max_obstacle_height: 2.0\n          clearing: True\n          marking: True\n          data_type: "LaserScan"\n          raytrace_max_range: 3.0\n          raytrace_min_range: 0.0\n          obstacle_max_range: 2.5\n          obstacle_min_range: 0.0\n      always_send_full_costmap: True\n  local_costmap_client:\n    ros__parameters:\n      use_sim_time: True\n  local_costmap_rclcpp_node:\n    ros__parameters:\n      use_sim_time: True\n\nglobal_costmap:\n  global_costmap:\n    ros__parameters:\n      update_frequency: 1.0\n      publish_frequency: 1.0\n      global_frame: map\n      robot_base_frame: base_link\n      use_sim_time: True\n      robot_radius: 0.3\n      resolution: 0.05\n      track_unknown_space: true\n      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]\n      obstacle_layer:\n        plugin: "nav2_costmap_2d::ObstacleLayer"\n        enabled: True\n        observation_sources: scan\n        scan:\n          topic: /scan\n          max_obstacle_height: 2.0\n          clearing: True\n          marking: True\n          data_type: "LaserScan"\n          raytrace_max_range: 3.0\n          raytrace_min_range: 0.0\n          obstacle_max_range: 2.5\n          obstacle_min_range: 0.0\n      static_layer:\n        plugin: "nav2_costmap_2d::StaticLayer"\n        map_subscribe_transient_local: True\n      inflation_layer:\n        plugin: "nav2_costmap_2d::InflationLayer"\n        cost_scaling_factor: 3.0\n        inflation_radius: 0.55\n      always_send_full_costmap: True\n  global_costmap_client:\n    ros__parameters:\n      use_sim_time: True\n  global_costmap_rclcpp_node:\n    ros__parameters:\n      use_sim_time: True\n\nmap_server:\n  ros__parameters:\n    use_sim_time: True\n    yaml_filename: "turtlebot3_world.yaml"\n\nmap_saver:\n  ros__parameters:\n    use_sim_time: True\n    save_map_timeout: 5.0\n    free_thresh_default: 0.25\n    occupied_thresh_default: 0.65\n\nplanner_server:\n  ros__parameters:\n    expected_planner_frequency: 20.0\n    use_sim_time: True\n    planner_plugins: ["GridBased"]\n    GridBased:\n      plugin: "nav2_navfn_planner/NavfnPlanner"\n      tolerance: 0.5\n      use_astar: false\n      allow_unknown: true\n\nplanner_server_rclcpp_node:\n  ros__parameters:\n    use_sim_time: True\n\nrecoveries_server:\n  ros__parameters:\n    costmap_topic: local_costmap/costmap_raw\n    footprint_topic: local_costmap/published_footprint\n    cycle_frequency: 10.0\n    recovery_plugins: ["spin", "backup", "wait"]\n    spin:\n      plugin: "nav2_recoveries/Spin"\n      sim_frequency: 10\n      angle_instep_thresh: 0.05\n      angle_tolerance: 0.1\n      max_rotational_vel: 1.0\n      min_rotational_vel: 0.4\n    backup:\n      plugin: "nav2_recoveries/BackUp"\n      sim_frequency: 10\n      distance: 0.15\n      forward_sampling_distance: 0.05\n      move_time_allowance: 10.0\n      max_translation_vel: 0.25\n    wait:\n      plugin: "nav2_recoveries/Wait"\n      sim_frequency: 10\n      backup_distance: 0.15\n      time_allowance: 5.0\n\nrobot_state_publisher:\n  ros__parameters:\n    use_sim_time: True\n\nwaypoint_follower:\n  ros__parameters:\n    loop_rate: 20\n    stop_on_failure: false\n    waypoint_task_executor_plugin: "wait_at_waypoint"\n    wait_at_waypoint:\n      plugin: "nav2_waypoint_follower::WaitAtWaypoint"\n      enabled: True\n      waypoint_pause_duration: 200\n'})}),"\n",(0,o.jsx)(e.h3,{id:"step-6-simulation-launch-file",children:"Step 6: Simulation Launch File"}),"\n",(0,o.jsx)(e.p,{children:"Create the main launch file:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"# File: nav_simulation/launch/navigation_simulation.launch.py\nfrom launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.actions import Node\nfrom launch_ros.substitutions import FindPackageShare\n\ndef generate_launch_description():\n    # Launch arguments\n    use_sim_time = LaunchConfiguration('use_sim_time', default='true')\n    world = LaunchConfiguration('world', default='empty.sdf')\n\n    # Launch Gazebo\n    gazebo = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource([\n            PathJoinSubstitution([\n                FindPackageShare('gazebo_ros'),\n                'launch',\n                'gazebo.launch.py'\n            ])\n        ]),\n        launch_arguments={\n            'world': world,\n            'verbose': 'true'\n        }.items()\n    )\n\n    # Robot state publisher\n    robot_state_publisher = Node(\n        package='robot_state_publisher',\n        executable='robot_state_publisher',\n        name='robot_state_publisher',\n        output='screen',\n        parameters=[{\n            'use_sim_time': use_sim_time,\n            'robot_description': open(PathJoinSubstitution([\n                FindPackageShare('nav_simulation'),\n                'urdf',\n                'diff_robot.urdf'\n            ]).perform({})).read()\n        }]\n    )\n\n    # Spawn robot in Gazebo\n    spawn_entity = Node(\n        package='gazebo_ros',\n        executable='spawn_entity.py',\n        arguments=[\n            '-topic', 'robot_description',\n            '-entity', 'diff_robot',\n            '-x', '0.0',\n            '-y', '0.0',\n            '-z', '0.0'\n        ],\n        output='screen'\n    )\n\n    # Launch navigation\n    navigation = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource([\n            PathJoinSubstitution([\n                FindPackageShare('nav2_bringup'),\n                'launch',\n                'navigation_launch.py'\n            ])\n        ]),\n        launch_arguments={\n            'use_sim_time': use_sim_time,\n            'params_file': PathJoinSubstitution([\n                FindPackageShare('nav_simulation'),\n                'config',\n                'nav2_params.yaml'\n            ])\n        }.items()\n    )\n\n    # Launch RViz\n    rviz = Node(\n        package='rviz2',\n        executable='rviz2',\n        name='rviz2',\n        arguments=['-d', PathJoinSubstitution([\n            FindPackageShare('nav2_bringup'),\n            'rviz',\n            'nav2_default_view.rviz'\n        ])],\n        parameters=[{'use_sim_time': use_sim_time}]\n    )\n\n    return LaunchDescription([\n        DeclareLaunchArgument(\n            'world',\n            default_value='empty.sdf',\n            description='Choose one of the world files from `/usr/share/gazebo-11/worlds`'\n        ),\n        gazebo,\n        robot_state_publisher,\n        spawn_entity,\n        navigation,\n        rviz\n    ])\n"})}),"\n",(0,o.jsx)(e.h3,{id:"step-7-custom-world-file",children:"Step 7: Custom World File"}),"\n",(0,o.jsx)(e.p,{children:"Create a world file for navigation testing:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0" ?>\n<sdf version="1.7">\n  <world name="navigation_world">\n    <physics type="ode">\n      <max_step_size>0.001</max_step_size>\n      <real_time_factor>1.0</real_time_factor>\n      <real_time_update_rate>1000</real_time_update_rate>\n    </physics>\n\n    <light name="sun" type="directional">\n      <pose>0 0 10 0 0 0</pose>\n      <diffuse>0.8 0.8 0.8 1</diffuse>\n      <specular>0.2 0.2 0.2 1</specular>\n      <direction>-0.4 0.2 -0.9</direction>\n    </light>\n\n    \x3c!-- Ground plane --\x3e\n    <model name="ground_plane">\n      <static>true</static>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <plane><normal>0 0 1</normal></plane>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <plane><normal>0 0 1</normal></plane>\n          </geometry>\n          <material>\n            <ambient>0.7 0.7 0.7 1</ambient>\n            <diffuse>0.7 0.7 0.7 1</diffuse>\n          </material>\n        </visual>\n      </link>\n    </model>\n\n    \x3c!-- Walls creating a maze-like structure --\x3e\n    <model name="wall_1">\n      <pose>0 5 0.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box><size>10 0.2 1</size></box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box><size>10 0.2 1</size></box>\n          </geometry>\n          <material><ambient>0.5 0.5 0.5 1</ambient></material>\n        </visual>\n      </link>\n    </model>\n\n    <model name="wall_2">\n      <pose>0 -5 0.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box><size>10 0.2 1</size></box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box><size>10 0.2 1</size></box>\n          </geometry>\n          <material><ambient>0.5 0.5 0.5 1</ambient></material>\n        </visual>\n      </link>\n    </model>\n\n    <model name="wall_3">\n      <pose>5 0 0.5 0 0 1.5708</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box><size>10 0.2 1</size></box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box><size>10 0.2 1</size></box>\n          </geometry>\n          <material><ambient>0.5 0.5 0.5 1</ambient></material>\n        </visual>\n      </link>\n    </model>\n\n    <model name="wall_4">\n      <pose>-5 0 0.5 0 0 1.5708</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box><size>10 0.2 1</size></box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box><size>10 0.2 1</size></box>\n          </geometry>\n          <material><ambient>0.5 0.5 0.5 1</ambient></material>\n        </visual>\n      </link>\n    </model>\n\n    \x3c!-- Interior obstacles --\x3e\n    <model name="obstacle_1">\n      <pose>2 2 0.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box><size>1 1 1</size></box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box><size>1 1 1</size></box>\n          </geometry>\n          <material><ambient>0.8 0.2 0.2 1</ambient></material>\n        </visual>\n      </link>\n    </model>\n\n    <model name="obstacle_2">\n      <pose>-2 -2 0.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <cylinder><radius>0.5</radius><length>1</length></cylinder>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <cylinder><radius>0.5</radius><length>1</length></cylinder>\n          </geometry>\n          <material><ambient>0.2 0.8 0.2 1</ambient></material>\n        </visual>\n      </link>\n    </model>\n\n    <model name="obstacle_3">\n      <pose>0 3 0.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <sphere><radius>0.4</radius></sphere>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <sphere><radius>0.4</radius></sphere>\n          </geometry>\n          <material><ambient>0.2 0.2 0.8 1</ambient></material>\n        </visual>\n      </link>\n    </model>\n\n    \x3c!-- Goal marker --\x3e\n    <model name="goal_marker">\n      <pose>4 4 0.1 0 0 0</pose>\n      <link name="link">\n        <visual name="visual">\n          <geometry>\n            <cylinder><radius>0.3</radius><length>0.2</length></cylinder>\n          </geometry>\n          <material><ambient>0.2 0.8 0.2 0.5</ambient></material>\n        </visual>\n      </link>\n    </model>\n  </world>\n</sdf>\n'})}),"\n",(0,o.jsx)(e.h3,{id:"step-8-performance-evaluation-node",children:"Step 8: Performance Evaluation Node"}),"\n",(0,o.jsx)(e.p,{children:"Create a node to evaluate navigation performance:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"# File: nav_simulation/nav_simulation/navigation_evaluator.py\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import PoseStamped, Twist\nfrom nav_msgs.msg import Odometry, Path\nfrom sensor_msgs.msg import LaserScan\nfrom std_msgs.msg import Float32, Bool\nfrom tf2_ros import TransformException\nfrom tf2_ros.buffer import Buffer\nfrom tf2_ros.transform_listener import TransformListener\nimport numpy as np\nfrom collections import deque\nimport time\n\nclass NavigationEvaluator(Node):\n    def __init__(self):\n        super().__init__('navigation_evaluator')\n\n        # Parameters\n        self.declare_parameter('evaluation_duration', 300)  # 5 minutes\n        self.declare_parameter('goal_tolerance', 0.5)\n        self.declare_parameter('collision_threshold', 0.3)\n\n        # TF2 setup for localization\n        self.tf_buffer = Buffer()\n        self.tf_listener = TransformListener(self.tf_buffer, self)\n\n        # Subscribers\n        self.odom_sub = self.create_subscription(\n            Odometry, '/odom', self.odom_callback, 10)\n        self.scan_sub = self.create_subscription(\n            LaserScan, '/scan', self.scan_callback, 10)\n        self.path_sub = self.create_subscription(\n            Path, '/plan', self.path_callback, 10)\n\n        # Publishers\n        self.collision_pub = self.create_publisher(Bool, '/collision', 10)\n        self.performance_pub = self.create_publisher(Float32, '/navigation_performance', 10)\n        self.distance_pub = self.create_publisher(Float32, '/traveled_distance', 10)\n\n        # Evaluation parameters\n        self.evaluation_duration = self.get_parameter('evaluation_duration').value\n        self.goal_tolerance = self.get_parameter('goal_tolerance').value\n        self.collision_threshold = self.get_parameter('collision_threshold').value\n\n        # State tracking\n        self.start_time = self.get_clock().now()\n        self.start_position = None\n        self.current_position = None\n        self.previous_position = None\n        self.total_distance = 0.0\n        self.collision_count = 0\n        self.path_efficiency = 0.0\n        self.collision_detected = False\n\n        # Goal position (will be set when navigation starts)\n        self.goal_position = None\n\n        # Setup evaluation timer\n        self.eval_timer = self.create_timer(1.0, self.evaluate_performance)\n\n        self.get_logger().info('Navigation Evaluator Node Started')\n\n    def odom_callback(self, msg):\n        self.current_position = np.array([msg.pose.pose.position.x,\n                                         msg.pose.pose.position.y])\n\n        if self.start_position is None:\n            self.start_position = self.current_position.copy()\n\n        # Calculate distance traveled\n        if self.previous_position is not None:\n            step_distance = np.linalg.norm(self.current_position - self.previous_position)\n            self.total_distance += step_distance\n\n        self.previous_position = self.current_position.copy()\n\n        # Publish traveled distance\n        distance_msg = Float32()\n        distance_msg.data = self.total_distance\n        self.distance_pub.publish(distance_msg)\n\n    def scan_callback(self, msg):\n        # Check for potential collisions\n        if min(msg.ranges) < self.collision_threshold:\n            self.collision_count += 1\n            self.collision_detected = True\n\n            collision_msg = Bool()\n            collision_msg.data = True\n            self.collision_pub.publish(collision_msg)\n\n    def path_callback(self, msg):\n        # Calculate path efficiency (if we have both planned path and actual path)\n        if len(msg.poses) > 0 and self.current_position is not None:\n            # Calculate planned path length\n            planned_length = 0.0\n            for i in range(1, len(msg.poses)):\n                p1 = np.array([msg.poses[i-1].pose.position.x,\n                              msg.poses[i-1].pose.position.y])\n                p2 = np.array([msg.poses[i].pose.position.x,\n                              msg.poses[i].pose.position.y])\n                planned_length += np.linalg.norm(p2 - p1)\n\n            # Calculate efficiency as ratio of direct distance to actual path\n            if self.start_position is not None:\n                direct_distance = np.linalg.norm(self.current_position - self.start_position)\n                if planned_length > 0:\n                    self.path_efficiency = direct_distance / planned_length\n\n    def evaluate_performance(self):\n        if self.current_position is None:\n            return\n\n        # Calculate time elapsed\n        current_time = self.get_clock().now()\n        time_elapsed = (current_time - self.start_time).nanoseconds / 1e9\n\n        # Calculate metrics\n        success_rate = 0.0\n        efficiency_score = 0.0\n        safety_score = 0.0\n\n        # Success: reached goal within tolerance\n        if self.goal_position is not None:\n            distance_to_goal = np.linalg.norm(self.current_position - self.goal_position)\n            if distance_to_goal <= self.goal_tolerance:\n                success_rate = 1.0\n\n        # Efficiency: path length vs direct distance\n        if self.start_position is not None and self.goal_position is not None:\n            direct_distance = np.linalg.norm(self.goal_position - self.start_position)\n            if direct_distance > 0:\n                efficiency_score = direct_distance / max(self.total_distance, direct_distance)\n\n        # Safety: inverse of collision frequency\n        max_expected_time = self.evaluation_duration\n        expected_collision_free_periods = time_elapsed / 10.0  # per 10 seconds\n        safety_score = max(0, 1.0 - (self.collision_count / max(1, expected_collision_free_periods)))\n\n        # Overall performance score (weighted combination)\n        performance_score = (success_rate * 0.4 +\n                           efficiency_score * 0.3 +\n                           safety_score * 0.3)\n\n        # Publish performance score\n        perf_msg = Float32()\n        perf_msg.data = performance_score\n        self.performance_pub.publish(perf_msg)\n\n        # Log performance metrics\n        self.get_logger().info(f'Performance Metrics - '\n                              f'Time: {time_elapsed:.1f}s, '\n                              f'Distance: {self.total_distance:.2f}m, '\n                              f'Collisions: {self.collision_count}, '\n                              f'Score: {performance_score:.3f}')\n\n        # Check if evaluation period is over\n        if time_elapsed > self.evaluation_duration:\n            self.get_logger().info(f'Evaluation completed after {time_elapsed:.1f}s')\n            self.get_logger().info(f'Final Score: {performance_score:.3f}')\n            # Could trigger next test scenario here\n\n    def set_goal(self, goal_x, goal_y):\n        \"\"\"Set the goal position for evaluation\"\"\"\n        self.goal_position = np.array([goal_x, goal_y])\n\ndef main(args=None):\n    rclpy.init(args=args)\n    evaluator = NavigationEvaluator()\n\n    try:\n        rclpy.spin(evaluator)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        evaluator.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,o.jsx)(e.h3,{id:"step-9-package-configuration",children:"Step 9: Package Configuration"}),"\n",(0,o.jsx)(e.p,{children:"Update the package.xml file:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>nav_simulation</name>\n  <version>0.0.0</version>\n  <description>Package for autonomous navigation simulation project</description>\n  <maintainer email="user@example.com">user</maintainer>\n  <license>Apache-2.0</license>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n  <depend>geometry_msgs</depend>\n  <depend>nav_msgs</depend>\n  <depend>sensor_msgs</depend>\n  <depend>tf2_ros</depend>\n  <depend>launch</depend>\n  <depend>launch_ros</depend>\n  <depend>robot_state_publisher</depend>\n  <depend>gazebo_ros</depend>\n  <depend>gazebo_plugins</depend>\n\n  <test_depend>ament_copyright</test_depend>\n  <test_depend>ament_flake8</test_depend>\n  <test_depend>ament_pep257</test_depend>\n  <test_depend>python3-pytest</test_depend>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,o.jsx)(e.p,{children:"Update the setup.py file:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"from setuptools import setup\nimport os\nfrom glob import glob\n\npackage_name = 'nav_simulation'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'launch'), glob('launch/*.launch.py')),\n        (os.path.join('share', package_name, 'urdf'), glob('urdf/*.urdf')),\n        (os.path.join('share', package_name, 'config'), glob('config/*.yaml')),\n        (os.path.join('share', package_name, 'worlds'), glob('worlds/*.sdf')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='user',\n    maintainer_email='user@example.com',\n    description='Package for autonomous navigation simulation project',\n    license='Apache-2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'navigation_evaluator = nav_simulation.navigation_evaluator:main',\n        ],\n    },\n)\n"})}),"\n",(0,o.jsx)(e.h3,{id:"step-10-running-the-system",children:"Step 10: Running the System"}),"\n",(0,o.jsx)(e.p,{children:"To run the complete navigation simulation:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# Build the package\ncd ~/nav_simulation_ws\ncolcon build --packages-select nav_simulation\nsource install/setup.bash\n\n# Run the simulation\nros2 launch nav_simulation navigation_simulation.launch.py world:=path/to/your/world.sdf\n\n# In another terminal, send a navigation goal\nros2 run nav2_msgs navigate_to_pose --ros-args -p 'pose.position.x:=4.0' -p 'pose.position.y:=4.0' -p 'pose.orientation.w:=1.0'\n\n# Or use the Rviz interface to set goals graphically\n"})}),"\n",(0,o.jsx)(e.h2,{id:"physical-ai-concepts-demonstrated",children:"Physical AI Concepts Demonstrated"}),"\n",(0,o.jsx)(e.h3,{id:"multi-sensor-integration",children:"Multi-Sensor Integration"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"LiDAR for obstacle detection"}),"\n",(0,o.jsx)(e.li,{children:"IMU for localization (simulated)"}),"\n",(0,o.jsx)(e.li,{children:"Camera for visual perception (simulated)"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"navigation-stack-integration",children:"Navigation Stack Integration"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"AMCL for localization"}),"\n",(0,o.jsx)(e.li,{children:"Nav2 for path planning and execution"}),"\n",(0,o.jsx)(e.li,{children:"Costmap for obstacle avoidance"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"performance-evaluation",children:"Performance Evaluation"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Quantitative metrics for navigation performance"}),"\n",(0,o.jsx)(e.li,{children:"Safety assessment through collision detection"}),"\n",(0,o.jsx)(e.li,{children:"Path efficiency measurement"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(e.h3,{id:"common-issues-and-solutions",children:"Common Issues and Solutions"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"Robot not moving"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Check controller configuration and connection"}),"\n",(0,o.jsx)(e.li,{children:"Verify TF tree is properly published"}),"\n",(0,o.jsx)(e.li,{children:"Ensure navigation stack is running"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"Localization problems"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Verify initial pose is set correctly"}),"\n",(0,o.jsx)(e.li,{children:"Check sensor data quality"}),"\n",(0,o.jsx)(e.li,{children:"Adjust AMCL parameters if needed"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"Path planning failures"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Check costmap configuration"}),"\n",(0,o.jsx)(e.li,{children:"Verify map quality and resolution"}),"\n",(0,o.jsx)(e.li,{children:"Adjust planner parameters"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"Performance issues"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Reduce simulation complexity if needed"}),"\n",(0,o.jsx)(e.li,{children:"Optimize costmap resolution"}),"\n",(0,o.jsx)(e.li,{children:"Check CPU/memory usage"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"chapter-summary",children:"Chapter Summary"}),"\n",(0,o.jsx)(e.p,{children:"This project integrated all the simulation concepts learned in Module 2 into a comprehensive autonomous navigation system. The system demonstrates how to combine Gazebo simulation, ROS 2 navigation stack, sensor simulation, and performance evaluation in a cohesive Physical AI application. The modular design allows for testing different navigation algorithms and evaluating their performance in various simulated environments."}),"\n",(0,o.jsx)(e.h2,{id:"exercises",children:"Exercises"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:"Modify the robot model to include additional sensors (e.g., IMU, GPS simulation)."}),"\n",(0,o.jsx)(e.li,{children:"Implement different navigation strategies and compare their performance."}),"\n",(0,o.jsx)(e.li,{children:"Create additional test environments with varying complexity levels."}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsx)(e.p,{children:"In the next chapter, we'll assess your understanding of simulation concepts through practical challenges and exercises."})]})}function m(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(_,{...n})}):_(n)}},8453:(n,e,a)=>{a.d(e,{R:()=>l,x:()=>s});var i=a(6540);const o={},t=i.createContext(o);function l(n){const e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:l(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);